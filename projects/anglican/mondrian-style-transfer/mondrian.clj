;; gorilla-repl.fileformat = 1

;; **
;;; # Gorilla REPL
;;; 
;;; Welcome to gorilla :-)
;;; 
;;; Shift + enter evaluates code. Hit alt+g twice in quick succession or click the menu icon (upper-right corner) for more commands ...
;;; 
;;; It's a good habit to run each worksheet in its own namespace: feel free to use the declaration we've provided below if you'd like.
;; **

;; @@
(ns physics
  (:require ;[org.nfrac.cljbox2d.core :refer [position]]
    [gorilla-plot.core :as plot]
    ;[gorilla-repl.image :as image]
    [cheshire.core :refer :all]
    [clojure.data.json :as json])
  (:use [anglican core runtime emit])
  (:import [org.jeromq ZMQ])) (println "Importing done.")

;;;;;;;;;;;;;;;;;;; CONFIGURATION

; target image dimensions. Should match the dimensions of the filename given in server.py
(def image-width 200)
(def image-height 201)

; number of times all rectangles are split: 2^n splits. Anything more than 6 or so is probably too much.
(def split-depth 4) 
; number of particles at each generation - a new generation is made every individual rectangle split. This can be changed by adjusting where the factor statement takes place.
(def particle-count 350)

; depth | particles | seconds to run
; 4       200         6
; 5       200         16
; 4       400         12
; 5       400         32
; 6       100         24
; 7       100         77

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(defdist factor* [] [] 
  (sample* [this] nil) 
  (observe* [this value] value))

(with-primitive-procedures [factor*] 
  (defm factor [log-weight] 
    (observe (factor*) log-weight)))

(defm random-from-list [l]
  (nth l (sample (uniform-discrete 0 (count l)))))

; ZMQ ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(def ctx (ZMQ/context 1)) 
(def socket (.socket ctx ZMQ/PAIR))
(.connect socket "tcp://127.0.0.1:5556")

(defn get-image-likelihood [x]
  (let [string-to-send (json/write-str x)]
    (.send socket string-to-send))
  (json/read-str (String. (.recv socket))))

; colors ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(def colors [[0   0   0  ]   ;black
             [255 255 255]   ;white
             [245 15  15 ]   ;red
             [250 227 23 ]   ;yellow
             [13  127 190]
             ]) ;blue

;(defm random-color []
;  (random-from-list colors))

(defm random-color []
  [(sample (uniform-discrete 0 255)) 
   (sample (uniform-discrete 0 255)) 
   (sample (uniform-discrete 0 255))])


; rectangles ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;(defm discrete-in-range [lower upper]
;  (let [split-proportion (random-from-list [0.5 0.333333 0.25])
;        split-point (floor (+ lower (+ (* lower split-proportion)
;                                       (* upper (- 1 split-proportion)))))]
;    split-point))

(defm generate-rectangles [steps-taken parent]
  ;(println parent)
  (let [parent-x   (nth parent 0)
        parent-y   (nth parent 1)
        parent-w   (nth parent 2)
        parent-h   (nth parent 3)
        parent-rgb (nth parent 4)]

    (if (sample (flip 0.5))
      ;(even? steps-taken)
      (let [x (sample 

                (uniform-discrete parent-x (if (<= (+ parent-x parent-w)
                                                   parent-x)
                                             (+ parent-x 1)
                                             (+ parent-x parent-w))))
            y parent-y
            width (- (+ parent-w parent-x) x)
            height parent-h
            rgb (random-color)
            rectangles [[x y width height rgb], 
                        [parent-x parent-y (- parent-w width) parent-h parent-rgb]]]
        rectangles)

      (let [x      parent-x
            y      (sample (uniform-discrete parent-y (if (<= (+ parent-y parent-h)
                                                              parent-y)
                                                        (+ parent-y 1)
                                                        (+ parent-y parent-h))))
            width  parent-w
            height (- (+ parent-h parent-y) y)
            rgb    (random-color)
            rectangles [[x y width height rgb], 
                        [parent-x parent-y parent-w (- parent-h height) parent-rgb]]]
        rectangles))))

; model/query ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(with-primitive-procedures [get-image-likelihood] 
  (defquery mondrian [recursive-depth-limit]
    (loop [image-description [[0 0 image-width image-height [255 255 255]]]
           steps-taken 0]
      (if (> steps-taken recursive-depth-limit)
        image-description
        (do
          ;old factor here
          (recur 
            (loop [remaining-rectangles image-description
                   new-rectangles []]

              (factor (get-image-likelihood new-rectangles))

              (if (empty? remaining-rectangles)
                new-rectangles
                (recur (rest remaining-rectangles)
                       (concat new-rectangles 
                               (generate-rectangles steps-taken 
                                                    (first remaining-rectangles))))
                ))
            (+ steps-taken 1))

          )))))

; p(mondrian image | star image) = (p(star | mondrian)*p(mondrian)) / p (star)

; sample/post-process ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(def generated-image (time (doall (take 1 (doquery :smc
                                                   mondrian [split-depth] ; depth
                                                   :number-of-particles particle-count)))))

(spit "generated.json" (json/write-str (:result (first generated-image))))

(.close socket)
;; @@
;; ->
;;; Importing done.
;;; &quot;Elapsed time: 11768.799625 msecs&quot;
;;; 
;; <-
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; @@
generated-image
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:log-weight</span>","value":":log-weight"},{"type":"html","content":"<span class='clj-double'>-1.9539612397379928E9</span>","value":"-1.9539612397379928E9"}],"value":"[:log-weight -1.9539612397379928E9]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:result</span>","value":":result"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>98</span>","value":"98"},{"type":"html","content":"<span class='clj-unkown'>92</span>","value":"92"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"html","content":"<span class='clj-long'>8</span>","value":"8"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>144</span>","value":"144"},{"type":"html","content":"<span class='clj-unkown'>44</span>","value":"44"},{"type":"html","content":"<span class='clj-unkown'>33</span>","value":"33"}],"value":"[144 44 33]"}],"value":"[98 92 2 8 [144 44 33]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>43</span>","value":"43"},{"type":"html","content":"<span class='clj-unkown'>92</span>","value":"92"},{"type":"html","content":"<span class='clj-long'>55</span>","value":"55"},{"type":"html","content":"<span class='clj-long'>8</span>","value":"8"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>209</span>","value":"209"},{"type":"html","content":"<span class='clj-unkown'>31</span>","value":"31"},{"type":"html","content":"<span class='clj-unkown'>25</span>","value":"25"}],"value":"[209 31 25]"}],"value":"[43 92 55 8 [209 31 25]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>93</span>","value":"93"},{"type":"html","content":"<span class='clj-unkown'>60</span>","value":"60"},{"type":"html","content":"<span class='clj-long'>7</span>","value":"7"},{"type":"html","content":"<span class='clj-long'>32</span>","value":"32"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>199</span>","value":"199"},{"type":"html","content":"<span class='clj-unkown'>12</span>","value":"12"},{"type":"html","content":"<span class='clj-unkown'>40</span>","value":"40"}],"value":"[199 12 40]"}],"value":"[93 60 7 32 [199 12 40]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>43</span>","value":"43"},{"type":"html","content":"<span class='clj-unkown'>60</span>","value":"60"},{"type":"html","content":"<span class='clj-long'>50</span>","value":"50"},{"type":"html","content":"<span class='clj-long'>32</span>","value":"32"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>235</span>","value":"235"},{"type":"html","content":"<span class='clj-unkown'>38</span>","value":"38"},{"type":"html","content":"<span class='clj-unkown'>15</span>","value":"15"}],"value":"[235 38 15]"}],"value":"[43 60 50 32 [235 38 15]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>26</span>","value":"26"},{"type":"html","content":"<span class='clj-unkown'>60</span>","value":"60"},{"type":"html","content":"<span class='clj-long'>17</span>","value":"17"},{"type":"html","content":"<span class='clj-long'>40</span>","value":"40"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>224</span>","value":"224"},{"type":"html","content":"<span class='clj-unkown'>46</span>","value":"46"},{"type":"html","content":"<span class='clj-unkown'>49</span>","value":"49"}],"value":"[224 46 49]"}],"value":"[26 60 17 40 [224 46 49]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>26</span>","value":"26"},{"type":"html","content":"<span class='clj-unkown'>60</span>","value":"60"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>40</span>","value":"40"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>209</span>","value":"209"},{"type":"html","content":"<span class='clj-unkown'>31</span>","value":"31"},{"type":"html","content":"<span class='clj-unkown'>43</span>","value":"43"}],"value":"[209 31 43]"}],"value":"[26 60 0 40 [209 31 43]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>17</span>","value":"17"},{"type":"html","content":"<span class='clj-unkown'>68</span>","value":"68"},{"type":"html","content":"<span class='clj-long'>9</span>","value":"9"},{"type":"html","content":"<span class='clj-long'>32</span>","value":"32"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>134</span>","value":"134"},{"type":"html","content":"<span class='clj-unkown'>83</span>","value":"83"},{"type":"html","content":"<span class='clj-unkown'>104</span>","value":"104"}],"value":"[134 83 104]"}],"value":"[17 68 9 32 [134 83 104]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>17</span>","value":"17"},{"type":"html","content":"<span class='clj-unkown'>60</span>","value":"60"},{"type":"html","content":"<span class='clj-long'>9</span>","value":"9"},{"type":"html","content":"<span class='clj-long'>8</span>","value":"8"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>189</span>","value":"189"},{"type":"html","content":"<span class='clj-unkown'>43</span>","value":"43"},{"type":"html","content":"<span class='clj-unkown'>38</span>","value":"38"}],"value":"[189 43 38]"}],"value":"[17 60 9 8 [189 43 38]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>33</span>","value":"33"},{"type":"html","content":"<span class='clj-unkown'>17</span>","value":"17"},{"type":"html","content":"<span class='clj-long'>67</span>","value":"67"},{"type":"html","content":"<span class='clj-long'>43</span>","value":"43"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>190</span>","value":"190"},{"type":"html","content":"<span class='clj-unkown'>65</span>","value":"65"},{"type":"html","content":"<span class='clj-unkown'>36</span>","value":"36"}],"value":"[190 65 36]"}],"value":"[33 17 67 43 [190 65 36]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>23</span>","value":"23"},{"type":"html","content":"<span class='clj-unkown'>17</span>","value":"17"},{"type":"html","content":"<span class='clj-long'>10</span>","value":"10"},{"type":"html","content":"<span class='clj-long'>43</span>","value":"43"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>210</span>","value":"210"},{"type":"html","content":"<span class='clj-unkown'>52</span>","value":"52"},{"type":"html","content":"<span class='clj-unkown'>34</span>","value":"34"}],"value":"[210 52 34]"}],"value":"[23 17 10 43 [210 52 34]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>23</span>","value":"23"},{"type":"html","content":"<span class='clj-unkown'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>77</span>","value":"77"},{"type":"html","content":"<span class='clj-long'>17</span>","value":"17"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>234</span>","value":"234"},{"type":"html","content":"<span class='clj-unkown'>216</span>","value":"216"},{"type":"html","content":"<span class='clj-unkown'>208</span>","value":"208"}],"value":"[234 216 208]"}],"value":"[23 0 77 17 [234 216 208]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>23</span>","value":"23"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>77</span>","value":"77"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>235</span>","value":"235"},{"type":"html","content":"<span class='clj-unkown'>99</span>","value":"99"},{"type":"html","content":"<span class='clj-unkown'>131</span>","value":"131"}],"value":"[235 99 131]"}],"value":"[23 0 77 0 [235 99 131]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>21</span>","value":"21"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"html","content":"<span class='clj-long'>60</span>","value":"60"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>127</span>","value":"127"},{"type":"html","content":"<span class='clj-unkown'>129</span>","value":"129"},{"type":"html","content":"<span class='clj-unkown'>97</span>","value":"97"}],"value":"[127 129 97]"}],"value":"[21 0 2 60 [127 129 97]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>17</span>","value":"17"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>4</span>","value":"4"},{"type":"html","content":"<span class='clj-long'>60</span>","value":"60"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>156</span>","value":"156"},{"type":"html","content":"<span class='clj-unkown'>162</span>","value":"162"},{"type":"html","content":"<span class='clj-unkown'>200</span>","value":"200"}],"value":"[156 162 200]"}],"value":"[17 0 4 60 [156 162 200]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>17</span>","value":"17"},{"type":"html","content":"<span class='clj-unkown'>58</span>","value":"58"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>189</span>","value":"189"},{"type":"html","content":"<span class='clj-unkown'>170</span>","value":"170"},{"type":"html","content":"<span class='clj-unkown'>191</span>","value":"191"}],"value":"[189 170 191]"}],"value":"[17 58 0 2 [189 170 191]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>17</span>","value":"17"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>58</span>","value":"58"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>234</span>","value":"234"},{"type":"html","content":"<span class='clj-unkown'>78</span>","value":"78"},{"type":"html","content":"<span class='clj-unkown'>43</span>","value":"43"}],"value":"[234 78 43]"}],"value":"[17 0 0 58 [234 78 43]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>16</span>","value":"16"},{"type":"html","content":"<span class='clj-unkown'>79</span>","value":"79"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-long'>21</span>","value":"21"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>221</span>","value":"221"},{"type":"html","content":"<span class='clj-unkown'>230</span>","value":"230"},{"type":"html","content":"<span class='clj-unkown'>221</span>","value":"221"}],"value":"[221 230 221]"}],"value":"[16 79 1 21 [221 230 221]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>15</span>","value":"15"},{"type":"html","content":"<span class='clj-unkown'>79</span>","value":"79"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-long'>21</span>","value":"21"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>216</span>","value":"216"},{"type":"html","content":"<span class='clj-unkown'>236</span>","value":"236"},{"type":"html","content":"<span class='clj-unkown'>244</span>","value":"244"}],"value":"[216 236 244]"}],"value":"[15 79 1 21 [216 236 244]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-unkown'>79</span>","value":"79"},{"type":"html","content":"<span class='clj-long'>14</span>","value":"14"},{"type":"html","content":"<span class='clj-long'>21</span>","value":"21"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>239</span>","value":"239"},{"type":"html","content":"<span class='clj-unkown'>242</span>","value":"242"},{"type":"html","content":"<span class='clj-unkown'>235</span>","value":"235"}],"value":"[239 242 235]"}],"value":"[1 79 14 21 [239 242 235]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-unkown'>79</span>","value":"79"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-long'>21</span>","value":"21"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>239</span>","value":"239"},{"type":"html","content":"<span class='clj-unkown'>247</span>","value":"247"},{"type":"html","content":"<span class='clj-unkown'>216</span>","value":"216"}],"value":"[239 247 216]"}],"value":"[0 79 1 21 [239 247 216]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-unkown'>77</span>","value":"77"},{"type":"html","content":"<span class='clj-long'>17</span>","value":"17"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>252</span>","value":"252"},{"type":"html","content":"<span class='clj-unkown'>233</span>","value":"233"},{"type":"html","content":"<span class='clj-unkown'>194</span>","value":"194"}],"value":"[252 233 194]"}],"value":"[0 77 17 2 [252 233 194]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-unkown'>72</span>","value":"72"},{"type":"html","content":"<span class='clj-long'>17</span>","value":"17"},{"type":"html","content":"<span class='clj-long'>5</span>","value":"5"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>94</span>","value":"94"},{"type":"html","content":"<span class='clj-unkown'>187</span>","value":"187"},{"type":"html","content":"<span class='clj-unkown'>135</span>","value":"135"}],"value":"[94 187 135]"}],"value":"[0 72 17 5 [94 187 135]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>3</span>","value":"3"},{"type":"html","content":"<span class='clj-unkown'>64</span>","value":"64"},{"type":"html","content":"<span class='clj-long'>14</span>","value":"14"},{"type":"html","content":"<span class='clj-long'>8</span>","value":"8"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>247</span>","value":"247"},{"type":"html","content":"<span class='clj-unkown'>212</span>","value":"212"},{"type":"html","content":"<span class='clj-unkown'>214</span>","value":"214"}],"value":"[247 212 214]"}],"value":"[3 64 14 8 [247 212 214]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-unkown'>64</span>","value":"64"},{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"},{"type":"html","content":"<span class='clj-long'>8</span>","value":"8"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>201</span>","value":"201"},{"type":"html","content":"<span class='clj-unkown'>237</span>","value":"237"},{"type":"html","content":"<span class='clj-unkown'>214</span>","value":"214"}],"value":"[201 237 214]"}],"value":"[0 64 3 8 [201 237 214]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>15</span>","value":"15"},{"type":"html","content":"<span class='clj-unkown'>56</span>","value":"56"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"html","content":"<span class='clj-long'>8</span>","value":"8"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>222</span>","value":"222"},{"type":"html","content":"<span class='clj-unkown'>246</span>","value":"246"},{"type":"html","content":"<span class='clj-unkown'>223</span>","value":"223"}],"value":"[222 246 223]"}],"value":"[15 56 2 8 [222 246 223]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>5</span>","value":"5"},{"type":"html","content":"<span class='clj-unkown'>56</span>","value":"56"},{"type":"html","content":"<span class='clj-long'>10</span>","value":"10"},{"type":"html","content":"<span class='clj-long'>8</span>","value":"8"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>228</span>","value":"228"},{"type":"html","content":"<span class='clj-unkown'>242</span>","value":"242"},{"type":"html","content":"<span class='clj-unkown'>208</span>","value":"208"}],"value":"[228 242 208]"}],"value":"[5 56 10 8 [228 242 208]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>10</span>","value":"10"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>7</span>","value":"7"},{"type":"html","content":"<span class='clj-long'>56</span>","value":"56"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>230</span>","value":"230"},{"type":"html","content":"<span class='clj-unkown'>230</span>","value":"230"},{"type":"html","content":"<span class='clj-unkown'>220</span>","value":"220"}],"value":"[230 230 220]"}],"value":"[10 0 7 56 [230 230 220]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>5</span>","value":"5"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>5</span>","value":"5"},{"type":"html","content":"<span class='clj-long'>56</span>","value":"56"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>238</span>","value":"238"},{"type":"html","content":"<span class='clj-unkown'>224</span>","value":"224"},{"type":"html","content":"<span class='clj-unkown'>210</span>","value":"210"}],"value":"[238 224 210]"}],"value":"[5 0 5 56 [238 224 210]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>3</span>","value":"3"},{"type":"html","content":"<span class='clj-unkown'>9</span>","value":"9"},{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"html","content":"<span class='clj-long'>55</span>","value":"55"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>215</span>","value":"215"},{"type":"html","content":"<span class='clj-unkown'>220</span>","value":"220"},{"type":"html","content":"<span class='clj-unkown'>203</span>","value":"203"}],"value":"[215 220 203]"}],"value":"[3 9 2 55 [215 220 203]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-unkown'>9</span>","value":"9"},{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"},{"type":"html","content":"<span class='clj-long'>55</span>","value":"55"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>242</span>","value":"242"},{"type":"html","content":"<span class='clj-unkown'>221</span>","value":"221"},{"type":"html","content":"<span class='clj-unkown'>190</span>","value":"190"}],"value":"[242 221 190]"}],"value":"[0 9 3 55 [242 221 190]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>5</span>","value":"5"},{"type":"html","content":"<span class='clj-long'>9</span>","value":"9"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>229</span>","value":"229"},{"type":"html","content":"<span class='clj-unkown'>253</span>","value":"253"},{"type":"html","content":"<span class='clj-unkown'>215</span>","value":"215"}],"value":"[229 253 215]"}],"value":"[0 0 5 9 [229 253 215]]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>9</span>","value":"9"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>255</span>","value":"255"},{"type":"html","content":"<span class='clj-long'>255</span>","value":"255"},{"type":"html","content":"<span class='clj-long'>255</span>","value":"255"}],"value":"[255 255 255]"}],"value":"[0 0 0 9 [255 255 255]]"}],"value":"([98 92 2 8 [144 44 33]] [43 92 55 8 [209 31 25]] [93 60 7 32 [199 12 40]] [43 60 50 32 [235 38 15]] [26 60 17 40 [224 46 49]] [26 60 0 40 [209 31 43]] [17 68 9 32 [134 83 104]] [17 60 9 8 [189 43 38]] [33 17 67 43 [190 65 36]] [23 17 10 43 [210 52 34]] [23 0 77 17 [234 216 208]] [23 0 77 0 [235 99 131]] [21 0 2 60 [127 129 97]] [17 0 4 60 [156 162 200]] [17 58 0 2 [189 170 191]] [17 0 0 58 [234 78 43]] [16 79 1 21 [221 230 221]] [15 79 1 21 [216 236 244]] [1 79 14 21 [239 242 235]] [0 79 1 21 [239 247 216]] [0 77 17 2 [252 233 194]] [0 72 17 5 [94 187 135]] [3 64 14 8 [247 212 214]] [0 64 3 8 [201 237 214]] [15 56 2 8 [222 246 223]] [5 56 10 8 [228 242 208]] [10 0 7 56 [230 230 220]] [5 0 5 56 [238 224 210]] [3 9 2 55 [215 220 203]] [0 9 3 55 [242 221 190]] [0 0 5 9 [229 253 215]] [0 0 0 9 [255 255 255]])"}],"value":"[:result ([98 92 2 8 [144 44 33]] [43 92 55 8 [209 31 25]] [93 60 7 32 [199 12 40]] [43 60 50 32 [235 38 15]] [26 60 17 40 [224 46 49]] [26 60 0 40 [209 31 43]] [17 68 9 32 [134 83 104]] [17 60 9 8 [189 43 38]] [33 17 67 43 [190 65 36]] [23 17 10 43 [210 52 34]] [23 0 77 17 [234 216 208]] [23 0 77 0 [235 99 131]] [21 0 2 60 [127 129 97]] [17 0 4 60 [156 162 200]] [17 58 0 2 [189 170 191]] [17 0 0 58 [234 78 43]] [16 79 1 21 [221 230 221]] [15 79 1 21 [216 236 244]] [1 79 14 21 [239 242 235]] [0 79 1 21 [239 247 216]] [0 77 17 2 [252 233 194]] [0 72 17 5 [94 187 135]] [3 64 14 8 [247 212 214]] [0 64 3 8 [201 237 214]] [15 56 2 8 [222 246 223]] [5 56 10 8 [228 242 208]] [10 0 7 56 [230 230 220]] [5 0 5 56 [238 224 210]] [3 9 2 55 [215 220 203]] [0 9 3 55 [242 221 190]] [0 0 5 9 [229 253 215]] [0 0 0 9 [255 255 255]])]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:predicts</span>","value":":predicts"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[],"value":"[]"}],"value":"[:predicts []]"}],"value":"{:log-weight -1.9539612397379928E9, :result ([98 92 2 8 [144 44 33]] [43 92 55 8 [209 31 25]] [93 60 7 32 [199 12 40]] [43 60 50 32 [235 38 15]] [26 60 17 40 [224 46 49]] [26 60 0 40 [209 31 43]] [17 68 9 32 [134 83 104]] [17 60 9 8 [189 43 38]] [33 17 67 43 [190 65 36]] [23 17 10 43 [210 52 34]] [23 0 77 17 [234 216 208]] [23 0 77 0 [235 99 131]] [21 0 2 60 [127 129 97]] [17 0 4 60 [156 162 200]] [17 58 0 2 [189 170 191]] [17 0 0 58 [234 78 43]] [16 79 1 21 [221 230 221]] [15 79 1 21 [216 236 244]] [1 79 14 21 [239 242 235]] [0 79 1 21 [239 247 216]] [0 77 17 2 [252 233 194]] [0 72 17 5 [94 187 135]] [3 64 14 8 [247 212 214]] [0 64 3 8 [201 237 214]] [15 56 2 8 [222 246 223]] [5 56 10 8 [228 242 208]] [10 0 7 56 [230 230 220]] [5 0 5 56 [238 224 210]] [3 9 2 55 [215 220 203]] [0 9 3 55 [242 221 190]] [0 0 5 9 [229 253 215]] [0 0 0 9 [255 255 255]]), :predicts []}"}],"value":"({:log-weight -1.9539612397379928E9, :result ([98 92 2 8 [144 44 33]] [43 92 55 8 [209 31 25]] [93 60 7 32 [199 12 40]] [43 60 50 32 [235 38 15]] [26 60 17 40 [224 46 49]] [26 60 0 40 [209 31 43]] [17 68 9 32 [134 83 104]] [17 60 9 8 [189 43 38]] [33 17 67 43 [190 65 36]] [23 17 10 43 [210 52 34]] [23 0 77 17 [234 216 208]] [23 0 77 0 [235 99 131]] [21 0 2 60 [127 129 97]] [17 0 4 60 [156 162 200]] [17 58 0 2 [189 170 191]] [17 0 0 58 [234 78 43]] [16 79 1 21 [221 230 221]] [15 79 1 21 [216 236 244]] [1 79 14 21 [239 242 235]] [0 79 1 21 [239 247 216]] [0 77 17 2 [252 233 194]] [0 72 17 5 [94 187 135]] [3 64 14 8 [247 212 214]] [0 64 3 8 [201 237 214]] [15 56 2 8 [222 246 223]] [5 56 10 8 [228 242 208]] [10 0 7 56 [230 230 220]] [5 0 5 56 [238 224 210]] [3 9 2 55 [215 220 203]] [0 9 3 55 [242 221 190]] [0 0 5 9 [229 253 215]] [0 0 0 9 [255 255 255]]), :predicts []})"}
;; <=

;; @@

;; @@
